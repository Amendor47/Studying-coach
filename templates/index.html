<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Study Coach ‚Äî Ultimate Learning Solution</title>
  <meta name="color-scheme" content="dark light" />
  <meta name="theme-color" content="#00e0b8" />
  
  <!-- Preconnect for performance -->
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  
  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  
  <!-- Stylesheets -->
  <link rel="stylesheet" href="{{ url_for('static', filename='design-system.css') }}" />
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}" />
  <link rel="stylesheet" href="{{ url_for('static', filename='advanced-flashcards.css') }}" />
  
  <!-- PWA Support -->
  <link rel="manifest" href="{{ url_for('static', filename='manifest.json') }}" />
  <meta name="mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  
  <!-- Performance optimizations -->
  <link rel="dns-prefetch" href="//fonts.googleapis.com">
  <link rel="preload" href="{{ url_for('static', filename='advanced-flashcards.js') }}" as="script">
</head>
<body>
  <!-- Background elements -->
  <div class="bg-grid"></div>
  <div class="flashcard-progress"></div>

  <!-- HEADER -->
  <header class="topbar">
    <div class="brand">
      <svg class="logo" viewBox="0 0 24 24" fill="none" aria-hidden="true">
        <rect x="3" y="6" width="18" height="12" rx="6" stroke="currentColor" stroke-width="1.8"/>
        <circle cx="12" cy="12" r="3" fill="currentColor"/>
      </svg>
      <span class="title">Study&nbsp;Coach</span>
    </div>

    <nav class="tabs" role="tablist">
      <button class="tab active" data-tab="import" role="tab">Importer</button>
      <button class="tab" data-tab="courses" role="tab">Cours</button>
      <button class="tab" data-tab="flash" role="tab">R√©visions</button>
      <button class="tab" data-tab="exercises" role="tab">Exercices</button>
      <button class="tab" data-tab="web" role="tab">Web</button>
      <button class="tab" data-tab="settings" role="tab">Param√®tres</button>
    </nav>
  </header>

  <!-- HERO -->
  <section class="hero">
    <div class="wrapper hero-inner">
      <h1 class="h1">Designed for focus</h1>
      <p class="sub">Un coach d‚Äô√©tude priv√©, rapide et lisible. Minimal, noir & blanc, avec juste ce qu‚Äôil faut d‚Äôaccent.</p>
      <div class="cta-row">
        <a class="btn btn-primary" href="#import">Commencer</a>
        <a class="btn btn-ghost" href="#web">Enrichir via Web</a>
      </div>
    </div>
  </section>

  <!-- MAIN -->
  <main class="wrapper stack">
    <!-- IMPORT -->
    <section id="import" class="panel active" role="tabpanel">
      <div class="panel-head">
        <h2>Importer un cours</h2>
        <p class="muted">PDF, DOCX, TXT ou Markdown. Analyse hors-IA fiable, IA optionnelle.</p>
      </div>

      <div class="card-grid">
        <div class="card">
          <label class="file">
            <input type="file" id="file-input" accept=".txt,.md,.pdf,.docx" />
            <span>Glisser-d√©poser ou cliquer pour choisir un fichier</span>
          </label>

          <div class="row">
            <select id="session-minutes" class="select">
              <option value="25">25 min</option>
              <option value="45">45 min</option>
              <option value="60">1 h</option>
              <option value="120">2 h</option>
              <option value="180">3 h</option>
            </select>
            <label class="check"><input type="checkbox" id="use-ai-upload" /> <span>Am√©liorer via IA</span></label>
          </div>

          <div class="row gap">
            <button id="upload-btn" class="btn btn-primary">Analyser le fichier</button>
            <button id="analyze-btn" class="btn">Analyser le texte</button>
            <button id="ai-btn" class="btn btn-ghost" disabled>Am√©liorer via IA</button>
          </div>
        </div>

        <div class="card">
          <textarea id="source-text" placeholder="Colle ici le contenu de ton cours‚Ä¶"></textarea>
        </div>
      </div>

      <!-- brouillons en colonnes -->
      <div id="drafts" class="grid-cols"></div>
    </section>

    <!-- COURS -->
    <section id="courses" class="panel" role="tabpanel">
      <div class="panel-head">
        <h2>Cours & fiches</h2>
        <p class="muted">Navigation par th√®mes. Les cartes s‚Äôaffichent en colonnes lisibles.</p>
      </div>
      <div id="themes" class="chips"></div>
      <div id="course-cards" class="grid-cols"></div>
    </section>

    <!-- R√âVISIONS AVANC√âES -->
    <section id="flash" class="panel" role="tabpanel">
      <div class="panel-head">
        <h2>R√©visions Intelligentes</h2>
        <p class="muted">Syst√®me avanc√© avec animations 60fps, reconnaissance gestuelle, et algorithmes d'espacement optimal.</p>
        <div class="revision-stats">
          <div class="stat-card">
            <div class="stat-value" id="due-count">0</div>
            <div class="stat-label">Cartes dues</div>
          </div>
          <div class="stat-card">
            <div class="stat-value" id="accuracy-rate">0%</div>
            <div class="stat-label">Pr√©cision</div>
          </div>
          <div class="stat-card">
            <div class="stat-value" id="streak-count">0</div>
            <div class="stat-label">S√©rie actuelle</div>
          </div>
        </div>
      </div>
      
      <!-- Advanced Flashcard Container -->
      <div id="flashcard-container" class="flashcard-main-container">
        <div class="flashcard-placeholder">
          <div class="placeholder-icon">üß†</div>
          <div class="placeholder-text">Chargement des cartes intelligentes...</div>
        </div>
      </div>
      
      <!-- Session Controls -->
      <div class="session-controls">
        <button class="btn btn-secondary" id="pause-session">
          ‚è∏Ô∏è Pause
        </button>
        <div class="session-timer" id="session-timer">00:00</div>
        <button class="btn btn-accent" id="settings-btn">
          ‚öôÔ∏è Param√®tres
        </button>
      </div>
      
      <!-- Keyboard shortcuts help -->
      <div class="keyboard-shortcuts" id="keyboard-help" style="display: none;">
        <h4>Raccourcis clavier</h4>
        <div class="shortcut-grid">
          <div class="shortcut-item">
            <kbd>Espace</kbd> <span>Retourner la carte</span>
          </div>
          <div class="shortcut-item">
            <kbd>1</kbd> <span>Encore (Difficile)</span>
          </div>
          <div class="shortcut-item">
            <kbd>2</kbd> <span>Difficile</span>
          </div>
          <div class="shortcut-item">
            <kbd>3</kbd> <span>Bien</span>
          </div>
          <div class="shortcut-item">
            <kbd>4</kbd> <span>Facile</span>
          </div>
        </div>
      </div>
    </section>

    <!-- EXERCICES -->
    <section id="exercises" class="panel" role="tabpanel">
      <div class="panel-head">
        <h2>Exercices QCM</h2>
        <p class="muted">Vraies questions, 4 options, correction instantan√©e.</p>
      </div>
      <div id="exercise-list" class="grid-cols"></div>
    </section>

    <!-- WEB -->
    <section id="web" class="panel" role="tabpanel">
      <div class="panel-head">
        <h2>Recherche web</h2>
        <p class="muted">Ajoute des sources fiables et transforme-les en fiches.</p>
      </div>
      <div class="card">
        <div class="row">
          <input id="web-q" class="input" placeholder="Ex : Photosynth√®se r√©sum√© fiable" />
          <label class="check"><input type="checkbox" id="web-ai" /> <span>Enrichir via IA</span></label>
          <button id="web-search" class="btn btn-primary">Rechercher</button>
        </div>
        <div id="web-results" class="stack-sm"></div>
      </div>
    </section>

    <!-- PARAM√àTRES AVANC√âS -->
    <section id="settings" class="panel" role="tabpanel">
      <div class="panel-head">
        <h2 class="text-3xl font-bold mb-4">Param√®tres Avanc√©s</h2>
        <p class="text-muted mb-6">Personnalisez votre exp√©rience d'apprentissage avec des options avanc√©es.</p>
      </div>
      
      <!-- Theme Settings -->
      <div class="card mb-6">
        <div class="card-header">
          <h3 class="text-xl font-semibold">üé® Th√®me et Apparence</h3>
        </div>
        <div class="card-body">
          <div class="grid gap-6">
            <div>
              <label class="block text-sm font-medium mb-2">Th√®me</label>
              <div class="flex gap-3">
                <button class="btn btn-secondary theme-btn" data-theme="auto">
                  üåì Auto
                </button>
                <button class="btn btn-secondary theme-btn" data-theme="light">
                  ‚òÄÔ∏è Clair
                </button>
                <button class="btn btn-secondary theme-btn active" data-theme="dark">
                  üåô Sombre
                </button>
              </div>
            </div>
            
            <div>
              <label class="block text-sm font-medium mb-2">Densit√© de l'interface</label>
              <select id="ui-density" class="input">
                <option value="compact">Compacte</option>
                <option value="comfortable" selected>Confortable</option>
                <option value="spacious">Spacieuse</option>
              </select>
            </div>
            
            <div>
              <label class="block text-sm font-medium mb-2">Taille de police</label>
              <input type="range" id="font-size" class="w-full" min="14" max="20" value="16" />
              <div class="flex justify-between text-xs text-muted mt-1">
                <span>Petit</span>
                <span>Moyen</span>
                <span>Grand</span>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Accessibility Settings -->
      <div class="card mb-6">
        <div class="card-header">
          <h3 class="text-xl font-semibold">‚ôø Accessibilit√©</h3>
        </div>
        <div class="card-body">
          <div class="space-y-4">
            <label class="flex items-center gap-3">
              <input type="checkbox" id="high-contrast" class="rounded" />
              <span>Mode contraste √©lev√©</span>
            </label>
            <label class="flex items-center gap-3">
              <input type="checkbox" id="reduce-motion" class="rounded" />
              <span>R√©duire les animations</span>
            </label>
            <label class="flex items-center gap-3">
              <input type="checkbox" id="dyslexia-font" class="rounded" />
              <span>Police adapt√©e √† la dyslexie</span>
            </label>
            <label class="flex items-center gap-3">
              <input type="checkbox" id="focus-indicators" class="rounded" checked />
              <span>Indicateurs de focus renforc√©s</span>
            </label>
          </div>
        </div>
      </div>
      
      <!-- Performance Settings -->
      <div class="card mb-6">
        <div class="card-header">
          <h3 class="text-xl font-semibold">‚ö° Performance</h3>
        </div>
        <div class="card-body">
          <div id="performance-stats" class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
            <div class="text-center">
              <div class="text-2xl font-bold text-primary" id="cache-hit-ratio">--</div>
              <div class="text-xs text-muted">Taux de cache</div>
            </div>
            <div class="text-center">
              <div class="text-2xl font-bold text-primary" id="avg-response-time">--</div>
              <div class="text-xs text-muted">Temps r√©ponse (ms)</div>
            </div>
            <div class="text-center">
              <div class="text-2xl font-bold text-primary" id="memory-usage">--</div>
              <div class="text-xs text-muted">M√©moire (MB)</div>
            </div>
            <div class="text-center">
              <div class="text-2xl font-bold text-primary" id="performance-score">--</div>
              <div class="text-xs text-muted">Score global</div>
            </div>
          </div>
          
          <div class="space-y-4">
            <label class="flex items-center gap-3">
              <input type="checkbox" id="enable-caching" class="rounded" checked />
              <span>Cache intelligent activ√©</span>
            </label>
            <label class="flex items-center gap-3">
              <input type="checkbox" id="preload-resources" class="rounded" checked />
              <span>Pr√©chargement des ressources</span>
            </label>
            <div class="flex gap-3 mt-4">
              <button id="clear-cache-btn" class="btn btn-secondary">
                üóëÔ∏è Vider le cache
              </button>
              <button id="optimize-performance-btn" class="btn btn-primary">
                üöÄ Optimiser
              </button>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Advanced Learning Settings -->
      <div class="card">
        <div class="card-header">
          <h3 class="text-xl font-semibold">üß† Apprentissage Intelligent</h3>
        </div>
        <div class="card-body">
          <div class="space-y-6">
            <div>
              <label class="block text-sm font-medium mb-2">Algorithme de r√©vision</label>
              <select id="srs-algorithm" class="input">
                <option value="sm2">SM-2 (Classique)</option>
                <option value="sm2-plus" selected>SM-2+ (Am√©lior√©)</option>
                <option value="fsrs">FSRS (Nouvelle g√©n√©ration)</option>
                <option value="adaptive">Adaptatif (IA)</option>
              </select>
            </div>
            
            <div>
              <label class="block text-sm font-medium mb-2">M√©thode p√©dagogique pr√©f√©r√©e</label>
              <select id="teaching-method" class="input">
                <option value="adaptive" selected>Adaptatif</option>
                <option value="socratic">M√©thode Socratique</option>
                <option value="scaffolding">√âchafaudage</option>
                <option value="active_recall">Rappel actif</option>
                <option value="elaborative">Apprentissage √©laboratif</option>
              </select>
            </div>
            
            <div>
              <label class="block text-sm font-medium mb-2">
                Dur√©e de session optimale: <span id="session-duration-value">25</span> minutes
              </label>
              <input type="range" id="session-duration" class="w-full" min="5" max="60" value="25" />
            </div>
            
            <div class="space-y-3">
              <label class="flex items-center gap-3">
                <input type="checkbox" id="adaptive-difficulty" class="rounded" checked />
                <span>Difficult√© adaptative</span>
              </label>
              <label class="flex items-center gap-3">
                <input type="checkbox" id="spaced-repetition-plus" class="rounded" checked />
                <span>R√©p√©tition espac√©e am√©lior√©e</span>
              </label>
              <label class="flex items-center gap-3">
                <input type="checkbox" id="learning-analytics" class="rounded" checked />
                <span>Analyse d'apprentissage avanc√©e</span>
              </label>
            </div>
          </div>
        </div>
      </div>
    </section>
  </main>

  <!-- TIMER -->
  <div id="timer" class="timer" aria-live="polite" title="Pomodoro">25:00</div>

  <!-- MODAL API KEY -->
  <div id="key-modal" class="modal hidden" role="dialog" aria-modal="true">
    <div class="modal-content card">
      <h3>Cl√© API OpenAI</h3>
      <p class="muted">Stock√©e localement. Utilis√©e uniquement si tu actives l‚ÄôIA cloud.</p>
      <input type="password" id="key-input" class="input" placeholder="sk-..." />
      <div class="row end">
        <button id="save-key" class="btn btn-primary">Enregistrer</button>
      </div>
    </div>
  </div>

  <!-- Advanced Features Settings Modal -->
  <div id="advanced-settings-modal" class="modal hidden" role="dialog" aria-modal="true">
    <div class="modal-content card">
      <h3>Param√®tres Avanc√©s</h3>
      
      <div class="settings-section">
        <h4>Animations et Interface</h4>
        <label class="check">
          <input type="checkbox" id="enable-animations" checked /> 
          <span>Animations hardware-accelerated</span>
        </label>
        <label class="check">
          <input type="checkbox" id="enable-gestures" checked /> 
          <span>Reconnaissance gestuelle (mobile)</span>
        </label>
        <label class="check">
          <input type="checkbox" id="enable-haptics" checked /> 
          <span>Retour haptique</span>
        </label>
      </div>
      
      <div class="settings-section">
        <h4>Apprentissage Intelligent</h4>
        <div class="setting-row">
          <label>M√©thode p√©dagogique pr√©f√©r√©e:</label>
          <select id="tutoring-method" class="input">
            <option value="adaptive">Adaptatif (recommand√©)</option>
            <option value="socratic">M√©thode Socratique</option>
            <option value="scaffolding">√âchafaudage p√©dagogique</option>
            <option value="active_recall">Rappel actif</option>
            <option value="elaborative">Apprentissage √©laboratif</option>
          </select>
        </div>
        <div class="setting-row">
          <label>Dur√©e de session optimale:</label>
          <input type="range" id="session-length" min="5" max="60" value="25" class="slider">
          <span id="session-length-value">25 minutes</span>
        </div>
      </div>
      
      <div class="settings-section">
        <h4>Analyse documentaire</h4>
        <label class="check">
          <input type="checkbox" id="enable-advanced-analysis" checked /> 
          <span>Analyse documentaire avanc√©e (OCR, formules math√©matiques)</span>
        </label>
        <label class="check">
          <input type="checkbox" id="enable-multimodal" checked /> 
          <span>Contenu multi-modal (images, audio)</span>
        </label>
      </div>
      
      <div class="row end">
        <button id="reset-settings" class="btn btn-ghost">R√©initialiser</button>
        <button id="save-advanced-settings" class="btn btn-primary">Sauvegarder</button>
      </div>
    </div>
  </div>

  <!-- Base URL and Error Handling -->
  <script>window.__BASE_URL__ = "";</script>
  <script src="{{ url_for('static', filename='baseurl.js') }}"></script>
  <script src="{{ url_for('static', filename='ui_error_overlay.js') }}"></script>
  
  <!-- Scripts -->
  <script src="{{ url_for('static', filename='performance-monitor.js') }}"></script>
  <script src="{{ url_for('static', filename='advanced-flashcards.js') }}"></script>
  <script src="{{ url_for('static', filename='app.js') }}"></script>
  
  <!-- Service Worker Registration -->
  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('/static/service-worker.js')
          .then(registration => {
            console.log('SW registered: ', registration);
          })
          .catch(registrationError => {
            console.log('SW registration failed: ', registrationError);
          });
      });
    }
  </script>
</body>
</html>
